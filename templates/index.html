<html>
  <head>
    <link href="{{ url_for('static', filename='bower_components/bootstrap/dist/css/bootstrap.css') }}"               rel="stylesheet" type="text/css">
    <link href="{{ url_for('static', filename='bower_components/bootstrap-select/dist/css/bootstrap-select.css') }}" rel="stylesheet" type="text/css">
    <link href="{{ url_for('static', filename='bower_components/datatables.net-dt/css/jquery.dataTables.css') }}"    rel="stylesheet" type="text/css">
    <link href="{{ url_for('static', filename='css/main.css') }}"                                                    rel="stylesheet" type="text/css">
    <link href="{{ url_for('static', filename='css/pv_graphic.css') }}"                                              rel="stylesheet" type="text/css">
    <script src="{{ url_for('static', filename='bower_components/socket.io-client/dist/socket.io.js') }}"></script>
    <script>
      var name_client_table_face_temp       = null;
      var name_client_table_pitch_temp      = null;
      var name_client_table_presence_temp   = null;
      var name_client_table_volume_temp     = null;
      var table_face_temp                   = null;
      var table_pitch_temp                  = null;
      var table_presence_temp               = null;
      var table_volume_temp                 = null;
      var received_data                     = null;
      var received_data_string              = "";
      var received_data_string_prev         = received_data_string;
      var received_data_table_client        = null;
      var received_data_table_client_json   = null;
      var received_data_table_face          = null;
      var received_data_table_face_json     = null;
      var received_data_table_pitch         = null;
      var received_data_table_pitch_json    = null;
      var received_data_table_presence      = null;
      var received_data_table_presence_json = null;
      var received_data_table_volume        = null;
      var received_data_table_volume_json   = null;
      var socket                            = io.connect("http://" + document.domain + ":" + location.port);



      socket.on("sent_table_client", function (_received_data) {
        received_data_table_client      = _received_data;
        received_data_table_client_json = JSON.stringify(received_data_table_client);
        // Creating table.
        $("#table_name_client").DataTable( {
            "paging"   : false,
            "searching": false,
            columns: [
                { data: "name"  , defaultContent: "None"},
                { data: "key_ir", defaultContent: "None"},
                { data: "dt"    , defaultContent: "None"}
            ],
            data: received_data_table_client,
        });

        // Set select pickers.
        var select_picker_client = ""
        for (var i = 0; i < received_data_table_client.length; i ++) {
          if (received_data_table_client[i]["name"]) {
            select_picker_client += "<option>" + received_data_table_client[i]["name"] + "</option>";
          }
        }
        $(".list_name_client").html(select_picker_client);
        $(".list_name_client").addClass("selectpicker");
        if ( /Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent) ) {
          $(".selectpicker").selectpicker("mobile");
        }
        else { $(".selectpicker").selectpicker(); }
      });



      socket.on("sent_table_face", function (_received_data) {
        received_data_table_face      = _received_data;
        received_data_table_face_json = JSON.stringify(received_data_table_face);
        // Updating table.
        $("#table_face").dataTable().fnClearTable();
        $("#table_face").dataTable().fnAddData(received_data_table_face);
        $("#table_face").dataTable().fnDraw();
      });



      socket.on("sent_table_pitch", function (_received_data) {
        received_data_table_pitch      = _received_data;
        received_data_table_pitch_json = JSON.stringify(received_data_table_pitch);
        // Updating table.
        $("#table_pitch").dataTable().fnClearTable();
        $("#table_pitch").dataTable().fnAddData(received_data_table_pitch);
        $("#table_pitch").dataTable().fnDraw();
      });



      socket.on("sent_table_presence", function (_received_data) {
        received_data_table_presence      = _received_data;
        received_data_table_presence_json = JSON.stringify(received_data_table_presence);
        // I need to edit the presence here so that it appears with commas.
        // CAUTION: For large loop this might lag the interface.
        for (var i = 0; i < received_data_table_presence.length; i ++) {
            if (received_data_table_presence[i].hasOwnProperty("value")) {
                received_data_table_presence[i]["value"] = received_data_table_presence[i]["value"].replace(",", ", ")
            }
        }

        // Updating table.
        $("#table_presence").dataTable().fnClearTable();
        $("#table_presence").dataTable().fnAddData(received_data_table_presence);
        $("#table_presence").dataTable().fnDraw();
      });



      socket.on("sent_table_volume", function (_received_data) {
        received_data_table_volume      = _received_data;
        received_data_table_volume_json = JSON.stringify(received_data_table_volume);
        // Updating table.
        $("#table_volume").dataTable().fnClearTable();
        $("#table_volume").dataTable().fnAddData(received_data_table_volume);
        $("#table_volume").dataTable().fnDraw();
      });



      socket.on("sent_input", function (_received_data) {
        received_data        = _received_data;
        received_data_string = JSON.stringify(_received_data);
      });
    </script>
  </head>
  <body>
    <div id="main_container" style="display:flex;height:100%;width:100%;">
      <div class="main" id="qr_code" style="align-items:center;display:flex;flex:1;justify-content:center;"></div>
      <div class="main" style="display:flex;flex:1;flex-direction:column;height:100%;">
        <div class="form-group" style="display:flex;flex-direction:row;margin:0;">
          <div style="flex:1;">
            <input class="form-control" id="value_qr" placeholder="this client name" style="text-align:center;" type="text">
          </div>
          <div style="flex:1;">
            <span class="input-group-btn" style="display:flex;flex-direction:row;width:100%;">
              <button class="btn btn-success" id="qr_activate" style="flex:1;" type="button">activate</button>
              <button class="btn btn-primary" id="qr_generate" style="flex:1;" type="button">generate</button>
              <button class="btn btn-danger" id="qr_deactivate" style="flex:1;" type="button">deactivate</button>
            </span>
          </div>
        </div>
        <div>
          <ul class="nav nav-tabs" style="display:flex;flex-direction:row;">
            <li class="active" style="flex:1;"><a data-toggle="tab" href="#cam" id="tab_cam" style="text-align:center;">cam</a></li>
            <li style="flex:1;"><a data-toggle="tab" href="#mic" id="tab_mic" style="text-align:center;">mic</a></li>
            <li style="flex:1;"><a data-toggle="tab" href="#api" style="text-align:center;">api</a></li>
            <li style="flex:2;"><a data-toggle="tab" href="#graph_client_prim" id="graph_client_prim_tab" style="text-align:center;">graph</a></li>
            <li style="flex:2;"><a data-toggle="tab" href="#graph_client_demo" id="graph_client_demo_tab" style="text-align:center;">graph demo</a></li>
          </ul>
        </div>
        <div class="tab-content" style="display:flex;flex:1;flex-direction:column;height:100%;">
          <div class="active tab-pane" id="cam" style="flex:1;height:100%;">
            <div style="display:flex;flex-direction:column;height:100%;">
              <div style="display:flex;flex-direction:row;">
                <div class="form-control" style="display:flex;flex:1;flex-direction:row;">
                  <label style="flex:1;">face:</label>
                  <div style="flex:1;overflow:hidden;">
                    <p id="value_face" style="text-align:center;">0</p>
                  </div>
                </div>
                <div class="form-control" style="display:flex;flex:1;flex-direction:row;">
                  <label>presence:</label>
                  <div style="flex:1;overflow:hidden;">
                    <p id="value_presence" style="text-align:center;">...</p>
                  </div>
                </div>
              </div>
              <div class="nice_background" id="video_container_container" style="display:flex;flex:1;flex-direction:row;">
                <div style="flex:1;"></div>
                <div style="display:flex;flex-direction:column;">
                  <div style="flex:1;"></div>
                  <div>
                    <div id="video_container" style="height:240px;margin:auto;position:relative;width:320px;">
                      <video class="item" height="240" id="video" style="bottom:0;height:240px;left:0;margin:auto;position:absolute;right:0;top:0;width:320px;" width="320"></video>
                      <canvas class="item" height="240" id="video_track_face" style="bottom:0;height:240px;left:0;margin:auto;position:absolute;right:0;top:0;width:320px;" width="320"></canvas>
                    </div>
                  </div>
                  <div style="flex:1;"></div>
                </div>
                <div style="flex:1;"></div>
              </div>
            </div>
          </div>
          <div class="tab-pane" id="mic" style="flex:1;height:100%;">
            <div style="display:flex;flex-direction:column;height:100%;">
              <div style="display:flex;flex-direction:row;">
                <div class="form-control" style="display:flex;flex:1;flex-direction:row;">
                  <label style="flex:1;">pitch:</label>
                  <div style="flex:1;overflow:hidden;">
                    <p id="value_pitch" style="text-align:center;">0</p>
                  </div>
                </div>
                <div class="form-control" style="display:flex;flex:1;flex-direction:row;">
                  <label style="flex:1;">volume:</label>
                  <div style="flex:1;overflow:hidden;">
                    <p id="value_volume" style="text-align:center;">0</p>
                  </div>
                </div>
              </div>
              <div style="display:flex;flex:1;height:100%;width:100%;">
                <div class="nice_background" id="mic_graph_container" style="display:flex;flex:1;">
                  <div class="pv_graph" id="graph_pitch" style="flex:1;"></div>
                  <div class="pv_graph" id="graph_volume" style="flex:1;"></div>
                </div>
              </div>
            </div>
          </div>
          <div class="tab-pane" id="api" style="flex:1;height:100%;">
            <div style="display:flex;flex-direction:column;height:100%;">
              <div>
                <ul class="nav nav-tabs" style="display:flex;flex-direction:row;">
                  <li class="active" style="flex:1;"><a data-toggle="tab" href="#client" style="text-align:center;">client</a></li>
                  <li style="flex:1;"><a data-toggle="tab" href="#face" style="text-align:center;">face</a></li>
                  <li style="flex:1;"><a data-toggle="tab" href="#pitch" style="text-align:center;">pitch</a></li>
                  <li style="flex:1;"><a data-toggle="tab" href="#presence" style="text-align:center;">presence</a></li>
                  <li style="flex:1;"><a data-toggle="tab" href="#volume" style="text-align:center;">vol</a></li>
                </ul>
              </div>
              <div style="display:flex;flex:1;flex-direction:column;height:100%;">
                <div class="tab-content" style="display:flex;flex:1;flex-direction:column;">
                  <div class="active tab-pane" id="client" style="flex:1;height:100%;">
                    <div style="display:flex;flex-direction:column;height:100%;">
                      <span class="input-group-btn" style="display:flex;flex-direction:row;width:100%;">
                        <button class="btn btn-primary" id="csv_table_client" style="flex:1;" type="button">download.csv</button>
                        <button class="btn btn-info" id="json_table_client" style="flex:1;" type="button">download .json</button>
                      </span>
                      <div style="flex:1;overflow-y:scroll;">
                        <table class="display" id="table_name_client" width="100%">
                          <thead>
                              <tr>
                                  <th>Name</th>
                                  <th>IR Key Code</th>
                                  <th>Latest Data Input</th>
                              </tr>
                          </thead>
                        </table>
                      </div>
                    </div>
                  </div>
                  <div class="tab-pane" id="face" style="flex:1;height:100%;">
                    <div style="display:flex;flex-direction:column;height:100%;">
                      <div style="display:flex;flex-direction:row;">
                        <div style="flex:1;">
                          <select class="face list_name_client" data-width="100%" title="choose client name">
                            <option>client_test_1</option>
                            <option>client_test_2</option>
                            <option>client_test_3</option>
                          </select>
                        </div>
                        <span class="input-group-btn" style="display:flex;flex:1;flex-direction:row;width:100%;">
                          <button class="btn btn-primary" id="csv_table_face" style="flex:1;" type="button">.csv</button>
                          <button class="btn btn-info" id="json_table_face" style="flex:1;" type="button">.json</button>
                        </span>
                      </div>
                      <div style="flex:1;overflow-y:scroll;">
                        <table class="display" id="table_face" width="100%">
                          <thead>
                              <tr>
                                <th>Latest Data Input</th>
                                <th>Face</th>
                              </tr>
                          </thead>
                        </table>
                      </div>
                    </div>
                  </div>
                  <div class="tab-pane" id="pitch" style="flex:1;height:100%;">
                    <div style="display:flex;flex-direction:column;height:100%;">
                      <div style="display:flex;flex-direction:row;">
                        <div style="flex:1;">
                          <select class="list_name_client pitch" data-width="100%" title="choose client name">
                            <option>client_test_1</option>
                            <option>client_test_2</option>
                            <option>client_test_3</option>
                          </select>
                        </div>
                        <span class="input-group-btn" style="display:flex;flex:1;flex-direction:row;width:100%;">
                          <button class="btn btn-primary" id="csv_table_pitch" style="flex:1;" type="button">.csv</button>
                          <button class="btn btn-info" id="json_table_pitch" style="flex:1;" type="button">.json</button>
                        </span>
                      </div>
                      <div style="flex:1;overflow-y:scroll;">
                        <table class="display" id="table_pitch" width="100%">
                          <thead>
                              <tr>
                                <th>Latest Data Input</th>
                                <th>Pitch</th>
                              </tr>
                          </thead>
                        </table>
                      </div>
                    </div>
                  </div>
                  <div class="tab-pane" id="presence" style="flex:1;height:100%;">
                    <div style="display:flex;flex-direction:column;height:100%;">
                      <div style="display:flex;flex-direction:row;">
                        <div style="flex:1;">
                          <select class="list_name_client presence" data-width="100%" title="choose client name">
                            <option>client_test_1</option>
                            <option>client_test_2</option>
                            <option>client_test_3</option>
                          </select>
                        </div>
                        <span class="input-group-btn" style="display:flex;flex:1;flex-direction:row;width:100%;">
                          <button class="btn btn-primary" id="csv_table_presence" style="flex:1;" type="button">.csv</button>
                          <button class="btn btn-info" id="json_table_presence" style="flex:1;" type="button">.json</button>
                        </span>
                      </div>
                      <div style="flex:1;overflow-y:scroll;">
                        <table class="display" id="table_presence" width="100%">
                          <thead>
                              <tr>
                                <th>Latest Data Input</th>
                                <th>Presence</th>
                              </tr>
                          </thead>
                        </table>
                      </div>
                    </div>
                  </div>
                  <div class="tab-pane" id="volume" style="flex:1;height:100%;">
                    <div style="display:flex;flex-direction:column;height:100%;">
                      <div style="display:flex;flex-direction:row;">
                        <div style="flex:1;">
                          <select class="list_name_client volume" data-width="100%" title="choose client name">
                            <option>client_test_1</option>
                            <option>client_test_2</option>
                            <option>client_test_3</option>
                          </select>
                        </div>
                        <span class="input-group-btn" style="display:flex;flex:1;flex-direction:row;width:100%;">
                          <button class="btn btn-primary" id="csv_table_volume" style="flex:1;" type="button">.csv</button>
                          <button class="btn btn-info" id="json_table_volume" style="flex:1;" type="button">.json</button>
                        </span>
                      </div>
                      <div style="flex:1;overflow-y:scroll;">
                        <table class="display" id="table_volume" width="100%">
                          <thead>
                              <tr>
                                <th>Latest Data Input</th>
                                <th>Volume</th>
                              </tr>
                          </thead>
                        </table>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="tab-pane" id="graph_client_prim" style="flex:1;height:100%;">
            <div style="display:flex;flex-direction:column;height:100%;">
              <div class="form-group" style="display:flex;flex-direction:row;margin:0;">
                <div style="flex:1;">
                  <input class="form-control" id="value_dt" placeholder="yyyymmddhhmmss" style="text-align:center;" type="text">
                </div>
                <div style="flex:1;">
                  <span class="input-group-btn" style="display:flex;flex-direction:row;width:100%;">
                    <button class="btn btn-primary" id="dt_go_to" style="flex:1;" type="button">go to</button>
                    <button class="btn btn-primary" id="dt_recent" style="flex:1;" type="button">recent</button>
                  </span>
                </div>
              </div>
              <div class="nice_background" style="display:flex;flex:1;flex-direction:row;height:100%;width:100%;">
                <div id="graph_client_prim_svg_container" style="flex:1;height:100%;width:100%;"></div>
              </div>
              <div style="display:flex;flex-direction:row;">
                <div class="form-control" style="display:flex;flex:1;flex-direction:row;">
                  <label style="flex:1;">name:</label>
                  <div style="flex:1;overflow:hidden;">
                    <p id="value_name_graph_client_prim" style="text-align:center;">...</p>
                  </div>
                </div>
                <div class="form-control" style="display:flex;flex:1;flex-direction:row;">
                  <label style="flex:1;">color:</label>
                  <div style="flex:1;overflow:hidden;">
                    <p id="value_color_graph_client_prim" style="text-align:center;">...</p>
                  </div>
                </div>
                <div class="form-control" style="display:flex;flex:1;flex-direction:row;">
                  <label style="flex:1;">face:</label>
                  <div style="flex:1;overflow:hidden;">
                    <p id="value_face_graph_client_prim" style="text-align:center;">0</p>
                  </div>
                </div>
              </div>
              <div style="display:flex;flex-direction:row;">
                <div class="form-control" style="display:flex;flex:1;flex-direction:row;">
                  <label style="flex:1;">pitch:</label>
                  <div style="flex:1;overflow:hidden;">
                    <p id="value_pitch_graph_client_prim" style="text-align:center;">0</p>
                  </div>
                </div>
                <div class="form-control" style="display:flex;flex:1;flex-direction:row;">
                  <label style="flex:1;">volume:</label>
                  <div style="flex:1;overflow:hidden;">
                    <p id="value_volume_graph_client_prim" style="text-align:center;">0</p>
                  </div>
                </div>
                <div class="form-control" style="display:flex;flex:2;flex-direction:row;">
                  <label>presence:</label>
                  <div style="flex:1;overflow:hidden;">
                    <p id="value_presence_graph_client_prim" style="text-align:center;">...</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="tab-pane" id="graph_client_demo" style="flex:1;height:100%;">
            <div style="display:flex;flex-direction:column;height:100%;">
              <div class="nice_background" style="display:flex;flex:1;flex-direction:row;height:100%;width:100%;">
                <div id="graph_client_demo_svg_container" style="flex:1;height:100%;width:100%;"></div>
              </div>
              <div style="display:flex;flex-direction:row;">
                <div class="form-control" style="display:flex;flex:1;flex-direction:row;">
                  <label style="flex:1;">name:</label>
                  <div style="flex:1;overflow:hidden;">
                    <p id="value_name_graph_client_demo" style="text-align:center;">...</p>
                  </div>
                </div>
                <div class="form-control" style="display:flex;flex:1;flex-direction:row;">
                  <label style="flex:1;">color:</label>
                  <div style="flex:1;overflow:hidden;">
                    <p id="value_color_graph_client_demo" style="text-align:center;">...</p>
                  </div>
                </div>
                <div class="form-control" style="display:flex;flex:1;flex-direction:row;">
                  <label style="flex:1;">face:</label>
                  <div style="flex:1;overflow:hidden;">
                    <p id="value_face_graph_client_demo" style="text-align:center;">0</p>
                  </div>
                </div>
              </div>
              <div style="display:flex;flex-direction:row;">
                <div class="form-control" style="display:flex;flex:1;flex-direction:row;">
                  <label style="flex:1;">pitch:</label>
                  <div style="flex:1;overflow:hidden;">
                    <p id="value_pitch_graph_client_demo" style="text-align:center;">0</p>
                  </div>
                </div>
                <div class="form-control" style="display:flex;flex:1;flex-direction:row;">
                  <label style="flex:1;">volume:</label>
                  <div style="flex:1;overflow:hidden;">
                    <p id="value_volume_graph_client_demo" style="text-align:center;">0</p>
                  </div>
                </div>
                <div class="form-control" style="display:flex;flex:2;flex-direction:row;">
                  <label>presence:</label>
                  <div style="flex:1;overflow:hidden;">
                    <p id="value_presence_graph_client_demo" style="text-align:center;">...</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script src="{{ url_for('static', filename='bower_components/jquery/dist/jquery.js') }}"                        type="text/javascript"></script>
    <script src="{{ url_for('static', filename='bower_components/bootstrap/dist/js/bootstrap.js') }}"               type="text/javascript"></script>
    <script src="{{ url_for('static', filename='bower_components/bootstrap-select/dist/js/bootstrap-select.js') }}" type="text/javascript"></script>
    <script src="{{ url_for('static', filename='bower_components/d3/d3.js') }}"                                     type="text/javascript"></script>
    <script src="{{ url_for('static', filename='bower_components/dat-gui/build/dat.gui.js') }}"                     type="text/javascript"></script>
    <script src="{{ url_for('static', filename='bower_components/datatables.net/js/jquery.dataTables.js') }}"       type="text/javascript"></script>
    <script src="{{ url_for('static', filename='bower_components/tracking/build/tracking.js') }}"                   type="text/javascript"></script>
    <script src="{{ url_for('static', filename='bower_components/tracking/build/data/face.js') }}"                  type="text/javascript"></script>
    <script src="{{ url_for('static', filename='node_modules/string/dist/string.js') }}"                            type="text/javascript"></script>
    <script src="{{ url_for('static', filename='manip/manip_color.js') }}"                                          type="text/javascript"></script>
    <script src="{{ url_for('static', filename='manip/manip_dict.js') }}"                                           type="text/javascript"></script>
    <script src="{{ url_for('static', filename='loose_lib/degree_radian.js') }}"                                    type="text/javascript"></script>
    <script src="{{ url_for('static', filename='loose_lib/instascan.min.js') }}"                                    type="text/javascript"></script>
    <script src="{{ url_for('static', filename='loose_lib/jsontocsvconverter.js') }}"                               type="text/javascript"></script>
    <script src="{{ url_for('static', filename='loose_lib/qrcode.js') }}"                                           type="text/javascript"></script>
    <script src="{{ url_for('static', filename='loose_lib/volume-meter.js') }}"                                     type="text/javascript"></script>
    <script src="{{ url_for('static', filename='detection/detection_face.js') }}"                                   type="text/javascript"></script>
    <script src="{{ url_for('static', filename='detection/detection_presence_qr.js') }}"                            type="text/javascript"></script>
    <script src="{{ url_for('static', filename='detection/detection_pv.js') }}"                                     type="text/javascript"></script>
    <script src="{{ url_for('static', filename='graphic/graph_client_prim.js') }}"                                  type="text/javascript"></script>
    <script src="{{ url_for('static', filename='graphic/graph_client_demo.js') }}"                                  type="text/javascript"></script>
    <script src="{{ url_for('static', filename='graphic/graph_pitch.js') }}"                                        type="text/javascript"></script>
    <script src="{{ url_for('static', filename='graphic/graph_volume.js') }}"                                       type="text/javascript"></script>
    <script src="{{ url_for('static', filename='graphic/graphic_qr_code.js') }}"                                    type="text/javascript"></script>
    <script>
      var active                                  = false;
      var layout_delay_in_second                  = 1;
      var mode_go_to                              = false;
      var resize_graph_client_demo_tag            = 0;
      var resize_graph_client_demo_tag_start      = false;
      var resize_graph_client_prim_tag            = 0;
      var resize_graph_client_prim_tag_start      = false;
      var resize_graph_pitch_tag                  = 0;
      var resize_graph_pitch_tag_start            = false;
      var resize_graph_pv_tag                     = 0;
      var resize_graph_pv_tag_start               = false;
      var resize_graph_volume_tag                 = 0;
      var resize_graph_volume_tag_start           = false;
      var resize_video_tag                        = 0;
      var resize_video_tag_start                  = false;
      var video_container_shortest_dimension      = null;
      var video_container_shortest_dimension_prev = video_container_shortest_dimension;
      var window_focus                            = true;

      div_container_graph_pitch                   = "#graph_pitch";
      div_container_graph_volume                  = "#graph_volume";

      function check_name_client(_string) {
        if (!S(_string.charAt(0)).isLower())                  { return false; }
        if (!S(_string.charAt(_string - 1)).isAlphaNumeric()) { return false; }

        for (var i = 0; i < _string.length; i ++) {
          if (
            S(_string.charAt(i)).isLower() ||
            S(_string.charAt(i)).isUpper()
          ) { continue; }
          else if (S(_string.charAt(i)).isNumeric()) {
            if (i < _string.length - 1) {
              if (S(_string.charAt(i + 1)).isLower()) {
                return false;
              }
            }
          }
          else{ return false; }
        }

        return true;
      }

      function init_graph_pv (_function, _has_inited, _init_time_in_second, _wait, _wait_start) {
        if (!_has_inited && _wait_start) {
          _wait ++;
          if (_wait > _init_time_in_second) {
            _function();
            _has_inited = true;
            _wait_start = false;
          }
        }
        return [_has_inited, _wait, _wait_start];
      }

      function print_value_in_array_of_dictionary (_array, _key) {
        var print = "";
        for (var i = 0; i < _array.length; i ++) {
          if (_array[i].hasOwnProperty(_key)) {
            print += _array[i][_key] + ", ";
          }
        }

        // If `print` valid remove two last characters.
        if (print) {
          print = print.substring(0, print.length - 2);
        }

        return print;
      }

      function resize_video () {
        video_container_shortest_dimension = $("#video_container_container").height() <= $("#video_container_container").width() ? $("#video_container_container").height() : $("#video_container_container").width(); // Check the shortest dimension.
        video_container_shortest_dimension = video_container_shortest_dimension > 320 ? 320 : video_container_shortest_dimension; // Make sure it is not larger  than 320 pixels. After 320 pixels the memory usage will be soared up high.

        if (
          video_container_shortest_dimension != video_container_shortest_dimension_prev &&
          video_container_shortest_dimension >= 10
        ) {
          $("#video")           .attr("height",        video_container_shortest_dimension*(3/4));
          $("#video")           .attr("width" ,        video_container_shortest_dimension);
          $("#video")           .css("height" , Number(video_container_shortest_dimension*(3/4)) + "px");
          $("#video")           .css("width"  ,        video_container_shortest_dimension + "px");
          $("#video_container") .css("height" , Number(video_container_shortest_dimension*(3/4)) + "px");
          $("#video_container") .css("width"  ,        video_container_shortest_dimension + "px");
          $("#video_track_face").attr("height",        video_container_shortest_dimension*(3/4));
          $("#video_track_face").attr("width" ,        video_container_shortest_dimension);
          $("#video_track_face").css("height" , Number(video_container_shortest_dimension*(3/4)) + "px");
          $("#video_track_face").css("width"  ,        video_container_shortest_dimension + "px");

          // Re - adjust tracking.
          init_detection_face();

          video_container_shortest_dimension_prev = video_container_shortest_dimension;
        }
      }

      $("#csv_table_client").click(function ()   { if (received_data_table_client_json != null)   { JSONToCSVConverter(received_data_table_client_json  , "csv_table_client"                                     , true); } });
      $("#csv_table_face").click(function ()     { if (received_data_table_face_json != null)     { JSONToCSVConverter(received_data_table_face_json    , "csv_table_face_"     + name_client_table_face_temp    , true); } });
      $("#csv_table_pitch").click(function ()    { if (received_data_table_pitch_json != null)    { JSONToCSVConverter(received_data_table_pitch_json   , "csv_table_pitch_"    + name_client_table_pitch_temp   , true); } });
      $("#csv_table_presence").click(function () { if (received_data_table_presence_json != null) { JSONToCSVConverter(received_data_table_presence_json, "csv_table_presence_" + name_client_table_presence_temp, true); } });
      $("#csv_table_volume").click(function ()   { if (received_data_table_volume_json != null)   { JSONToCSVConverter(received_data_table_volume_json  , "csv_table_volume_"   + name_client_table_volume_temp  , true); } });

      $("#dt_go_to").click(function () {
        mode_go_to = true;
      });

      $("#dt_recent").click(function () {
        mode_go_to = false;
      });

      $("#graph_client_demo_tab").click(function () {
        resize_graph_client_demo_tag_start = true;
      });

      $("#graph_client_prim_tab").click(function () {
        resize_graph_client_prim_tag_start = true;
      });

      $("#json_table_client").click(function ()   { if (received_data_table_client_json != null)   { JSONPrint(received_data_table_client_json  , "csv_table_client"                                     ); } });
      $("#json_table_face").click(function ()     { if (received_data_table_face_json != null)     { JSONPrint(received_data_table_face_json    , "csv_table_face_"     + name_client_table_face_temp    ); } });
      $("#json_table_pitch").click(function ()    { if (received_data_table_pitch_json != null)    { JSONPrint(received_data_table_pitch_json   , "csv_table_pitch_"    + name_client_table_pitch_temp   ); } });
      $("#json_table_presence").click(function () { if (received_data_table_presence_json != null) { JSONPrint(received_data_table_presence_json, "csv_table_presence_" + name_client_table_presence_temp); } });
      $("#json_table_volume").click(function ()   { if (received_data_table_volume_json != null)   { JSONPrint(received_data_table_volume_json  , "csv_table_volume_"   + name_client_table_volume_temp  ); } });


      $("#tab_cam").click(function () {
        resize_video_tag_start = true;
      });

      $("#tab_mic").click(function () {
        resize_graph_pitch_tag_start  = true;
        resize_graph_volume_tag_start = true;
        resize_graph_pv_tag_start     = true;
      });

      $("#qr_activate").click(function () {
        // Before activating for database input make sure the client name convention is correct.
        if (check_name_client(document.getElementById("value_qr").value)){
          $("#qr_activate").html("active");
          active = true;
          init_qr_code();
        }
        else {
          active = false;
          window.alert("wrong client name format\nplease use camelCase\nfor example: \"user\", \"user12\", or \"user12Again\"");
        }
      });

      $("#qr_deactivate").click(function () {
        $("#qr_activate").html("activate");
        active = false;
      });

      $("#qr_generate").click(function () {
        init_qr_code();
      });

      $("#value_qr")
        .keypress(function (e) {
          if (e.keyCode == 13) { // If ENTER just pressed down.
            init_qr_code();
          }
        })
        .on("blur", function () {
          init_qr_code();
        });

      $(".face.list_name_client").on("changed.bs.select", function () {
        name_client_table_face_temp     = $(".face.list_name_client").find("option:selected").text();
        table_face_temp                 = "face_" + name_client_table_face_temp;
        socket.emit("request_table_face", { "name_table":table_face_temp });
      });

      $(".list_name_client.pitch").on("changed.bs.select", function () {
        name_client_table_pitch_temp    = $(".list_name_client.pitch").find("option:selected").text();
        table_pitch_temp                = "pitch_" + name_client_table_pitch_temp;
        socket.emit("request_table_pitch", { "name_table":table_pitch_temp });
      });

      $(".list_name_client.presence").on("changed.bs.select", function () {
        name_client_table_presence_temp = $(".list_name_client.presence").find("option:selected").text();
        table_presence_temp             = "presence_" + name_client_table_presence_temp;
        socket.emit("request_table_presence", { "name_table":table_presence_temp });
      });

      $(".list_name_client.volume").on("changed.bs.select", function () {
        name_client_table_volume_temp   = $(".list_name_client.volume").find("option:selected").text();
        table_volume_temp               = "volume_" + name_client_table_volume_temp;
        socket.emit("request_table_volume", { "name_table":table_volume_temp });
      });

      $(document).ready(function () {
        // Blame the users if they are not using Chromium based browser.
        window.alert("please use chromium based browser");
        init_detection_face();
        init_detection_presence_qr();
        init_detection_pv();
        init_graph_client_demo();
        init_qr_code();
        insert_from_url_qr_code();
        insert_from_url_dt();
        resize_video();
        // Requesting up table.
        socket.emit("request_table_client");
        // Setting up table.
        $("#table_face").DataTable( {
            "lengthMenu": [[20], [20]],
            "searching": false,
            columns: [
                { data: "dt"   , defaultContent: "None"},
                { data: "value", defaultContent: "None"}
            ]
        });
        $("#table_pitch").DataTable( {
            "lengthMenu": [[20], [20]],
            "searching": false,
            columns: [
                { data: "dt"   , defaultContent: "None"},
                { data: "value", defaultContent: "None"}
            ]
        });
        $("#table_presence").DataTable( {
            "lengthMenu": [[20], [20]],
            "searching": false,
            columns: [
                { data: "dt"   , defaultContent: "None"},
                { data: "value", defaultContent: "None"}
            ]
        });
        $("#table_volume").DataTable( {
            "lengthMenu": [[20], [20]],
            "searching": false,
            columns: [
                { data: "dt"   , defaultContent: "None"},
                { data: "value", defaultContent: "None"}
            ]
        });
      });

      $(window)
        .blur (function () { window_focus = false; })
        .focus(function () { window_focus = true ; })
        .resize(function () {
          init_qr_code();
          resize_video();
          resize_graph_client_demo();
          resize_graph_client_prim();
          if (has_inited_graph_pitch && has_inited_graph_volume) {
            resize_graph_pitch();
            resize_graph_volume();
          }
        });

      window.setInterval(function () {
        pitch_update  = true; // Basically loop for pitch  detection.
        volume_update = true; // Basically loop for volume detection.
        loop_detection_presence_qr();

        // Initiate the pitch and volume graph.
        var pitch_init = init_graph_pv(init_graph_pitch, has_inited_graph_pitch, layout_delay_in_second, resize_graph_pitch_tag, resize_graph_pitch_tag_start);
        var volume_init = init_graph_pv(init_graph_volume, has_inited_graph_volume, layout_delay_in_second, resize_graph_volume_tag, resize_graph_volume_tag_start);
        // Set the primitives back because the damn JavaScript cannot refer to reference on primitive type data!
        has_inited_graph_pitch = pitch_init[0]; resize_graph_pitch_tag = pitch_init[1]; resize_graph_pitch_tag_start = pitch_init[2];
        has_inited_graph_volume = volume_init[0]; resize_graph_volume_tag = volume_init[1]; resize_graph_volume_tag_start = volume_init[2];

        if (resize_graph_client_demo_tag_start) {
          resize_graph_client_demo_tag ++;
          if (resize_graph_client_demo_tag > layout_delay_in_second) {
            resize_graph_client_demo();
            resize_graph_client_demo_tag       = 0;
            resize_graph_client_demo_tag_start = false;
          }
        }

        if (resize_graph_client_prim_tag_start) {
          resize_graph_client_prim_tag ++;
          if (resize_graph_client_prim_tag > layout_delay_in_second) {
            resize_graph_client_prim();
            resize_graph_client_prim_tag       = 0;
            resize_graph_client_prim_tag_start = false;
          }
        }

        // Resize `<video>` and all components of face tracking but wait `layout_delay_in_second` seconds to let the `<div>` grows first.
        // CAUTION: Code maybe not optimized here! It needs to efficiently checks if `resize_video_start == true` and check if there is height or width of 0.
        if (resize_video_tag_start) {
          resize_video_tag ++;
          if (resize_video_tag > layout_delay_in_second) {
            // Optimization can be done here. For example make codes to check if there is a change in size in all video containers.
            // If there is change then resize the video.
            resize_video();
            resize_video_tag       = 0;
            resize_video_tag_start = false;
          }
        }
        // Make a safe pre - caution if the video has any dimensions of 0 then keep resizing it.
        if (video_container_shortest_dimension <= 10) { resize_video(); }

        // Resize graph but wait `layout_delay_in_second` seconds to let the `<div>` grows first.
        if (resize_graph_pv_tag_start) {
          resize_graph_pv_tag ++;
          if (resize_graph_pv_tag > layout_delay_in_second) {
            if (
              // Check if both graphs were already exists.
              (has_inited_graph_pitch && has_inited_graph_volume) &&
              // Check if there is a difference in size between each graph dimensions and its container dimension.
              (
                (height_graph_pitch  !== ($(div_container_graph_pitch).height()  - bottom_padding_graph_pitch))  ||
                (width_graph_pitch   !==  $(div_container_graph_pitch).width())                                  ||
                (height_graph_volume !== ($(div_container_graph_volume).height() - bottom_padding_graph_volume)) ||
                (width_graph_volume  !==  $(div_container_graph_volume).width())
              )
            ) {
              //console.log((has_inited_graph_pitch && has_inited_graph_volume));
              //console.log(height_graph_pitch  + " !== " + ($(div_container_graph_pitch).height() - bottom_padding_graph_pitch)   + " = " + (height_graph_pitch  !== ($(div_container_graph_pitch).height() - bottom_padding_graph_pitch)));
              //console.log(width_graph_pitch   + " !== " +  $(div_container_graph_pitch).width()                                  + " = " + (width_graph_pitch   !==  $(div_container_graph_pitch).width()));
              //console.log(height_graph_volume + " !== " + ($(div_container_graph_volume).height() - bottom_padding_graph_volume) + " = " + (height_graph_volume !== ($(div_container_graph_volume).height() - bottom_padding_graph_volume)));
              //console.log(width_graph_volume  + " !== " +  $(div_container_graph_volume).width()                                 + " = " + (width_graph_volume  !==  $(div_container_graph_volume).width()));
              resize_graph_pitch();
              resize_graph_volume();
            }
            resize_graph_pv_tag       = 0;
            resize_graph_pv_tag_start = false;
          }
        }

        // Database insert from `#value_qr`.
        if (active) {
          var date_formatted       = {};
          var now                  = new Date();
          var sent_data            = {};
          date_formatted["year"]   = Number(now.getFullYear());
          date_formatted["month"]  = Number(now.getUTCMonth())   < 10 ? String("0" + now.getUTCMonth())   : Number(now.getUTCMonth());
          date_formatted["day"]    = Number(now.getUTCDate())    < 10 ? String("0" + now.getUTCDate())    : Number(now.getUTCDate());
          date_formatted["hour"]   = Number(now.getUTCHours())   < 10 ? String("0" + now.getUTCHours())   : Number(now.getUTCHours());
          date_formatted["minute"] = Number(now.getUTCMinutes()) < 10 ? String("0" + now.getUTCMinutes()) : Number(now.getUTCMinutes());
          date_formatted["second"] = Number(now.getUTCSeconds()) < 10 ? String("0" + now.getUTCSeconds()) : Number(now.getUTCSeconds());
          dt = String(date_formatted["year"]) +
            String(date_formatted["month"])   +
            String(date_formatted["day"])     +
            String(date_formatted["hour"])    +
            String(date_formatted["minute"])  +
            String(date_formatted["second"]);
          sent_data["dt"]     = dt;
          sent_data["face"]   = value_face;
          sent_data["name"]   = name_client;
          sent_data["pitch"]  = value_pitch;
          sent_data["volume"] = value_volume;
          if (value_presence) { sent_data["presence"] = value_presence; }
          socket.emit("request_input_to_database", sent_data)
        }
        // Real - time graph. Make sure there is a change in the `received_data`.
        if (received_data_string !== received_data_string_prev) {
          init_graph_client(received_data);
          received_data_string_prev = received_data_string;
        }
      }, 1000);
      window.setInterval(function () {
        // Only do simulation when the `#graph_client_demo` is active
        if ($("#graph_client_demo").hasClass("active") && window_focus) { client_demo_all(); }

        // Web socket connection.
        if (!mode_go_to) { socket.emit("request_input_latest"); }
        else             { socket.emit("request_input_dt", {"dt":$("#value_dt").val()}); }
      }, 2000);
    </script>
  </body>
</html>